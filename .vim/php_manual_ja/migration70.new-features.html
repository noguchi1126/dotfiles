<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>新機能</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="migration70.incompatible.html">下位互換性のない変更点</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="migration70.deprecated.html">PHP 7.0.x で推奨されなくなる機能</a></div>
 <div class="up"><a href="migration70.html">PHP 5.6.x から PHP 7.0.x への移行</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="migration70.new-features" class="sect1">
 <h2 class="title">新機能</h2>

 <div class="sect2" id="migration70.new-features.scalar-type-declarations">
  <h3 class="title">スカラー型宣言</h3>

  <p class="para">
   スカラー
   <a href="functions.arguments.html#functions.arguments.type-declaration" class="link">型宣言</a>
   には二つの方式があります。デフォルトの自動変換 (coercive) モードと、
   厳密に判断する strict モードです。
   パラメータとして、
   文字列 (<span class="type"><a href="language.types.string.html" class="type string">string</a></span>)、整数 (<em>int</em>)、浮動小数点数
   (<span class="type"><a href="language.types.float.html" class="type float">float</a></span>)、boolean (<em>bool</em>)
   といった型をいずれかの方式で強制できるようになりました。
   これらは、PHP 5 で導入された型宣言 (クラス名やインターフェイス、配列そして <span class="type"><a href="language.types.callable.html" class="type callable">callable</a></span>)
   を強化するものです。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;デフォルトのモード<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">sumOfInts</span><span style="color: #007700">(</span><span style="color: #0000BB">int&nbsp;</span><span style="color: #007700">...</span><span style="color: #0000BB">$ints</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">array_sum</span><span style="color: #007700">(</span><span style="color: #0000BB">$ints</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">sumOfInts</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'3'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4.1</span><span style="color: #007700">));</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(9)
</pre></div>
   </div>
  </div>

  <p class="para">
   strict モードを有効にするには、ファイルの先頭に <a href="control-structures.declare.html" class="link"><em>declare</em></a> ディレクティブを置く必要があります。
   つまり、スカラー型を厳密に扱うかどうかは、ファイル単位で定めるということです。
   このディレクティブは、パラメータの型宣言だけでなく、関数の戻り値の型
   (<a href="functions.returning-values.html#functions.returning-values.type-declaration" class="link">戻り値の型宣言</a>を参照ください)
   や PHP の標準関数、そして拡張モジュールの関数にも影響を及ぼします。
  </p>

  <p class="para">
   スカラー型宣言に関するドキュメントやサンプルについては、
   <a href="functions.arguments.html#functions.arguments.type-declaration" class="link">型宣言</a>
   を参照ください。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.return-type-declarations">
  <h3 class="title">戻り値の型宣言</h3>

  <p class="para">
   PHP 7 では、
   <a href="functions.returning-values.html#functions.returning-values.type-declaration" class="link">戻り値の型宣言</a>
   もできるようになりました。
   <a href="functions.arguments.html#functions.arguments.type-declaration" class="link">引数の型宣言</a>
   と同様に、戻り値の型宣言では、関数が戻す値がどの型になるかを宣言します。
   戻り値の型宣言で使える
   <a href="functions.arguments.html#functions.arguments.type-declaration.types" class="link">型</a>
   は、引数の型宣言で使えるものと同じです。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">arraysSum</span><span style="color: #007700">(array&nbsp;...</span><span style="color: #0000BB">$arrays</span><span style="color: #007700">):&nbsp;array<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">array_map</span><span style="color: #007700">(function(array&nbsp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">):&nbsp;</span><span style="color: #0000BB">int&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">array_sum</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;</span><span style="color: #0000BB">$arrays</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">arraysSum</span><span style="color: #007700">([</span><span style="color: #0000BB">1</span><span style="color: #007700">,</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">3</span><span style="color: #007700">],&nbsp;[</span><span style="color: #0000BB">4</span><span style="color: #007700">,</span><span style="color: #0000BB">5</span><span style="color: #007700">,</span><span style="color: #0000BB">6</span><span style="color: #007700">],&nbsp;[</span><span style="color: #0000BB">7</span><span style="color: #007700">,</span><span style="color: #0000BB">8</span><span style="color: #007700">,</span><span style="color: #0000BB">9</span><span style="color: #007700">]));</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [0] =&gt; 6
    [1] =&gt; 15
    [2] =&gt; 24
)
</pre></div>
   </div>
  </div>

  <p class="para">
   詳細なドキュメントやサンプルについては、
   <a href="functions.returning-values.html#functions.returning-values.type-declaration" class="link">戻り値の型宣言</a>.
   を参照ください。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.null-coalesce-op">
  <h3 class="title">Null 合体演算子</h3>

  <p class="para">
   null 合体演算子 (<em>??</em>) がシンタックスシュガーとして追加されました。
   三項演算子と <span class="function"><a href="function.isset.html" class="function">isset()</a></span> を組み合わせる
   よくありがちなパターンを、より簡単に書くためのものです。
   この演算子は、もし第一オペランドが非 <strong><code>NULL</code></strong> の値であればそれを返し、
   そうでない場合は第二オペランドを返します。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;$_GET['user']&nbsp;を取得します。もし存在しない場合は<br />//&nbsp;'nobody'&nbsp;を用います。<br /></span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">]&nbsp;??&nbsp;</span><span style="color: #DD0000">'nobody'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;上のコードは、次のコードと同じ意味です。<br /></span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;isset(</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">])&nbsp;?&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">]&nbsp;:&nbsp;</span><span style="color: #DD0000">'nobody'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;合体演算子を連結することもできます。次のように書くと、<br />//&nbsp;$_GET['user']、$_POST['user']&nbsp;そして&nbsp;'nobody'<br />//&nbsp;の順に調べて、非&nbsp;&amp;null;&nbsp;が定義されている最初の値を返します。<br /></span><span style="color: #0000BB">$username&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">]&nbsp;??&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">]&nbsp;??&nbsp;</span><span style="color: #DD0000">'nobody'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  
 </div>

 <div class="sect2" id="migration70.new-features.spaceship-op">
  <h3 class="title">宇宙船演算子</h3>
  <p class="para">
   宇宙船演算子は、二つの式を比較するために使うものです。
   <var class="varname"><var class="varname">$a</var></var> が <var class="varname"><var class="varname">$b</var></var> より大きい場合は 1、
   <var class="varname"><var class="varname">$a</var></var> と <var class="varname"><var class="varname">$b</var></var> が等しい場合は 0、
   <var class="varname"><var class="varname">$a</var></var> が <var class="varname"><var class="varname">$b</var></var> より小さい場合は -1 をそれぞれ返します。
   比較の際には、
   <a href="types.comparisons.html" class="link">PHP 型の比較表</a>
   のルールを用います。
  </p>
  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;整数値<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;-1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /><br />//&nbsp;浮動小数点数値<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">1.5&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">1.5</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">1.5&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">2.5</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;-1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">2.5&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #0000BB">1.5</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br />&nbsp;<br />//&nbsp;文字列<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"a"&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #DD0000">"a"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"a"&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #DD0000">"b"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;-1<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"b"&nbsp;</span><span style="color: #007700">&lt;=&gt;&nbsp;</span><span style="color: #DD0000">"a"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  
 </div>

 <div class="sect2" id="migration70.new-features.define-array">
  <h3 class="title"><span class="function"><a href="function.define.html" class="function">define()</a></span> を用いた配列定数の定義</h3>

  <p class="para">
   <span class="function"><a href="function.define.html" class="function">define()</a></span> で配列の定数を定義できるようになりました。
   PHP 5.6 までのバージョンでは、配列の定数は <a href="language.constants.syntax.html" class="link"><em>const</em></a> でしか定義できませんでした。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />define</span><span style="color: #007700">(</span><span style="color: #DD0000">'ANIMALS'</span><span style="color: #007700">,&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'dog'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'cat'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'bird'<br /></span><span style="color: #007700">]);<br /><br />echo&nbsp;</span><span style="color: #0000BB">ANIMALS</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;"cat"&nbsp;と出力します<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect2" id="migration70.new-features.anonymous-classes">
  <h3 class="title">無名クラス</h3>

  <p class="para">
   無名クラスをサポートするようになりました。<em>new
   class</em> を使って利用します。
   その場限りの使い捨てのオブジェクトなどで、完全なクラス定義のかわりとして使えます。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">interface&nbsp;</span><span style="color: #0000BB">Logger&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">log</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$msg</span><span style="color: #007700">);<br />}<br /><br />class&nbsp;</span><span style="color: #0000BB">Application&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$logger</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLogger</span><span style="color: #007700">():&nbsp;</span><span style="color: #0000BB">Logger&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">setLogger</span><span style="color: #007700">(</span><span style="color: #0000BB">Logger&nbsp;$logger</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">logger&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$logger</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br /></span><span style="color: #0000BB">$app&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Application</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setLogger</span><span style="color: #007700">(new&nbsp;class&nbsp;implements&nbsp;</span><span style="color: #0000BB">Logger&nbsp;</span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">log</span><span style="color: #007700">(</span><span style="color: #0000BB">string&nbsp;$msg</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$msg</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />});<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$app</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLogger</span><span style="color: #007700">());<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
object(class@anonymous)#2 (0) {
}
</pre></div>
   </div>
  </div>

  <p class="para">
   詳細なドキュメントは
   <a href="language.oop5.anonymous.html" class="link">無名クラス</a>
   を参照ください。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.unicode-codepoint-escape-syntax">
  <h3 class="title">Unicode コードポイントエスケープ構文</h3>

  <p class="para">
   Unicode のコードポイントを十六進形式で受け取って、
   それを UTF-8 で (ダブルクォートで囲まれた文字列あるいはヒアドキュメントとして) 出力します。
   妥当な形式のコードポイントならあらゆるものが使えます。先頭のゼロは省略してもかまいません。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
echo&nbsp;"\u{aa}";<br />echo&nbsp;"\u{0000aa}";<br />echo&nbsp;"\u{9999}";</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
ª
ª (先頭のゼロを省略せずに書いても、前の行と同じ結果になります)
香
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect2" id="migration70.new-features.closure-call-method">
  <h3 class="title"><span class="methodname"><a href="closure.call.html" class="methodname">Closure::call()</a></span></h3>

  <p class="para">
   <span class="methodname"><a href="closure.call.html" class="methodname">Closure::call()</a></span>
   は、オブジェクトのスコープをクロージャに一時的に束縛して実行するための、
   より高性能で簡潔な方法です。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">A&nbsp;</span><span style="color: #007700">{private&nbsp;</span><span style="color: #0000BB">$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;}<br /><br /></span><span style="color: #FF8000">//&nbsp;以前のバージョンのコード<br /></span><span style="color: #0000BB">$getXCB&nbsp;</span><span style="color: #007700">=&nbsp;function()&nbsp;{return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x</span><span style="color: #007700">;};<br /></span><span style="color: #0000BB">$getX&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$getXCB</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">bindTo</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'A'</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;中間クロージャが必要<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$getX</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;PHP&nbsp;7&nbsp;以降でのコード<br /></span><span style="color: #0000BB">$getX&nbsp;</span><span style="color: #007700">=&nbsp;function()&nbsp;{return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">x</span><span style="color: #007700">;};<br />echo&nbsp;</span><span style="color: #0000BB">$getX</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">call</span><span style="color: #007700">(new&nbsp;</span><span style="color: #0000BB">A</span><span style="color: #007700">);</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
1
1
</pre></div>
   </div>
  </div>
 </div>
 <div class="sect2" id="migration70.new-features.filtered-unserialize">
  <h3 class="title"><span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> のフィルタリング</h3>

  <p class="para">
   この仕組みは、信頼できないデータからオブジェクトを復元する際に、
   よりセキュリティを高められるようにするために用意されたものです。
   デシリアライズ可能なクラスの一覧をホワイトリストとして定義することで、
   コードインジェクション攻撃を防ぎます。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;オブジェクトはすべて、__PHP_Incomplete_Class&nbsp;のオブジェクトに変換します<br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">"allowed_classes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">]);<br /><br /></span><span style="color: #FF8000">//&nbsp;MyClassとMyClass2以外のすべてのオブジェクトを、__PHP_Incomplete_Class&nbsp;のオブジェクトに変換します<br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">"allowed_classes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">"MyClass"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"MyClass2"</span><span style="color: #007700">]]);<br /><br /></span><span style="color: #FF8000">//&nbsp;デフォルト&nbsp;(第二引数を省略した場合)&nbsp;の挙動は以下のようになり、すべてのオブジェクトをそのまま復元します<br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">"allowed_classes"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">]);</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect2" id="migration70.new-features.intlchar">
  <h3 class="title"><a href="class.intlchar.html" class="classname">IntlChar</a></h3>

  <p class="para">
   ICU のさらなる機能を利用するために、新しく <a href="class.intlchar.html" class="classname">IntlChar</a>
   クラスが追加されました。このクラスには数々の static メソッドと定数が定義されており、
   これらを使って Unicode の文字を操作できます。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'%x'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">IntlChar</span><span style="color: #007700">::</span><span style="color: #0000BB">CODEPOINT_MAX</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #0000BB">IntlChar</span><span style="color: #007700">::</span><span style="color: #0000BB">charName</span><span style="color: #007700">(</span><span style="color: #DD0000">'@'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">IntlChar</span><span style="color: #007700">::</span><span style="color: #0000BB">ispunct</span><span style="color: #007700">(</span><span style="color: #DD0000">'!'</span><span style="color: #007700">));</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
10ffff
COMMERCIAL AT
bool(true)
</pre></div>
   </div>
  </div>

  <p class="para">
   このクラスを使うには、<a href="book.intl.html" class="link">Intl</a> 拡張モジュールをインストールしなければいけません。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.expectations">
  <h3 class="title">Expectation</h3>

  <p class="para">
   <a href="function.assert.html#function.assert.expectations" class="link">Expectations</a> は、かつての
   <span class="function"><a href="function.assert.html" class="function">assert()</a></span> 関数を、下位互換性を保ったまま拡張したものです。
   これを用いると、コストをかけずに実運用コードの中にアサーションを組み込めます。
   そして、アサーションが失敗した際に自作の例外をスローできるようになります。
  </p>

  <p class="para">
   これまでの API も下位互換性を保つために維持されていますが、
   <span class="function"><a href="function.assert.html" class="function">assert()</a></span> は言語構造となりました。
   最初のパラメータには、単に評価対象の文字列や <span class="type"><a href="language.types.boolean.html" class="type boolean">boolean</a></span>
   値を指定するだけではなく、式を渡せます。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'assert.exception'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br /><br />class&nbsp;</span><span style="color: #0000BB">CustomError&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">AssertionError&nbsp;</span><span style="color: #007700">{}<br /><br /></span><span style="color: #0000BB">assert</span><span style="color: #007700">(</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;new&nbsp;</span><span style="color: #0000BB">CustomError</span><span style="color: #007700">(</span><span style="color: #DD0000">'Some&nbsp;error&nbsp;message'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
Fatal error: Uncaught CustomError: Some error message
</pre></div>
   </div>
  </div>

  <p class="para">
   開発環境および運用環境での設定方法などの詳細については、
   <span class="function"><a href="function.assert.html" class="function">assert()</a></span> のマニュアルの
   <a href="function.assert.html#function.assert.expectations" class="link">expectation</a>
   の節を参照ください。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.group-use-declarations">
  <h3 class="title"><em>use</em> 宣言のグループ化</h3>

  <p class="para">
   複数のクラスや関数そして定数を同じ <a href="language.namespaces.definition.html" class="link"><em>namespace</em></a> からインポートする際に、
   単一の <a href="language.namespaces.importing.html" class="link"><em>use</em></a> 文にまとめられるようになりました。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;以前のバージョンのコード<br /></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ClassA</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ClassB</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ClassC&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">C</span><span style="color: #007700">;<br /><br />use&nbsp;function&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">fn_a</span><span style="color: #007700">;<br />use&nbsp;function&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">fn_b</span><span style="color: #007700">;<br />use&nbsp;function&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">fn_c</span><span style="color: #007700">;<br /><br />use&nbsp;const&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ConstA</span><span style="color: #007700">;<br />use&nbsp;const&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ConstB</span><span style="color: #007700">;<br />use&nbsp;const&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\</span><span style="color: #0000BB">ConstC</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;PHP&nbsp;7&nbsp;以降のコード<br /></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\{</span><span style="color: #0000BB">ClassA</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ClassB</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ClassC&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">C</span><span style="color: #007700">};<br />use&nbsp;function&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\{</span><span style="color: #0000BB">fn_a</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">fn_b</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">fn_c</span><span style="color: #007700">};<br />use&nbsp;const&nbsp;</span><span style="color: #0000BB">some</span><span style="color: #007700">\namespace\{</span><span style="color: #0000BB">ConstA</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ConstB</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ConstC</span><span style="color: #007700">};<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect2" id="migration70.new-features.generator-return-expressions">
  <h3 class="title">ジェネレータでの return</h3>

  <p class="para">
   PHP 5.5 で導入されたジェネレータの機能拡張です。
   ジェネレータの内部で <em>return</em> 文が使えるようになりました。
   これを使えば、ジェネレータが最終的に返す式を指定できます (参照を返すことはできません)。
   この値を取得するには、新しいメソッド
   <em>Generator::getReturn()</em> を用います。
   このメソッドを使うのは、ジェネレータが値の生成を終えた後の一度だけになるでしょう。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$gen&nbsp;</span><span style="color: #007700">=&nbsp;(function()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;2</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">;<br />})();<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$gen&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />}<br /><br />echo&nbsp;</span><span style="color: #0000BB">$gen</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getReturn</span><span style="color: #007700">(),&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
1
2
3
</pre></div>
   </div>
  </div>

  <p class="para">
   ジェネレータの最終値を明示的に返せる機能は、あれば便利なものです。
   ジェネレータを実行したクライアント側のコードが、
   ジェネレータが最後に返す値 (何らかのコルーチンの計算結果) を特別扱いできるようになるからです。
   「取得した値が最後の値かどうかをまず調べて、最後であれば特別扱いする」
   という処理をクライアント側で書くよりは、ずっとシンプルになります。
  </p>
 </div>
 <div class="sect2" id="migration70.new-features.generator-delegation">
  <h3 class="title">ジェネレータの委譲</h3>

  <p class="para">
   ジェネレータを、別のジェネレータや
   <a href="class.traversable.html" class="classname">Traversable</a> オブジェクトそして配列に委譲できるようになりました。
   外側のジェネレータに決まり文句を書いたりする必要はなく、単に <a href="language.generators.syntax.html#control-structures.yield.from" class="link"><em>yield from</em></a> 構文を使うだけです。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">gen</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;1</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;2</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;from&nbsp;gen2</span><span style="color: #007700">();<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">gen2</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;3</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">yield&nbsp;4</span><span style="color: #007700">;<br />}<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">gen</span><span style="color: #007700">()&nbsp;as&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
1
2
3
4
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect2" id="migration70.new-features.intdiv">
  <h3 class="title"><span class="function"><a href="function.intdiv.html" class="function">intdiv()</a></span> による整数の除算</h3>

  <p class="para">
   新しい <span class="function"><a href="function.intdiv.html" class="function">intdiv()</a></span> 関数は、
   オペランドに対して整数の除算を行い、その結果を返します。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">intdiv</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">3</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <p class="para">上の例の出力は以下となります。</p>
   <div class="example-contents screen">
<div class="cdata"><pre>
int(3)
</pre></div>
   </div>
  </div>
 </div>

 <div class="sect2" id="migration70.new-features.session-start-options">
  <h3 class="title">セッションのオプション</h3>

  <p class="para">
   <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span> にオプションの配列を渡せるようになりました。
   これは、php.ini などで設定した
   <a href="session.configuration.html" class="link">session 設定ディレクティブ</a>
   を上書きします。
  </p>

  <p class="para">
   新たな設定オプション
   <a href="session.configuration.html#ini.session.lazy-write" class="link">session.lazy_write</a>
   をサポートするようになりました。これはデフォルトで有効になっており、
   セッションのデータが書き換えられたときにだけセッションファイルを上書きします。
   また、<em>read_and_close</em> も追加されました。
   このオプションは <span class="function"><a href="function.session-start.html" class="function">session_start()</a></span> だけに渡せるもので、
   セッションデータを読み込んだら何も変更せずその場でクローズするよう指示します。
  </p>

  <p class="para">
   たとえば、
   <a href="session.configuration.html#ini.session.cache-limiter" class="link">session.cache_limiter</a>
   を <em>private</em> にして、読み込んだセッションをすぐにクローズさせるには次のようにします。
  </p>

  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />session_start</span><span style="color: #007700">([<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'cache_limiter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'private'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'read_and_close'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />]);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect2" id="migration70.new-features.preg-repace-callback-array-function">
  <h3 class="title"><span class="function"><a href="function.preg-replace-callback-array.html" class="function">preg_replace_callback_array()</a></span></h3>

  <p class="para">
   新しい <span class="function"><a href="function.preg-replace-callback-array.html" class="function">preg_replace_callback_array()</a></span> 関数は、
   <span class="function"><a href="function.preg-replace-callback.html" class="function">preg_replace_callback()</a></span> 関数を使ったコードをよりすっきりと書けるようにするものです。
   これまでのバージョンの PHP では、正規表現ごとにコールバックを実行したければ、
   コールバック関数が分岐だらけになってしまっていました。
  </p>

  <p class="para">
   PHP 7 以降では、個々の正規表現に対するコールバックを連想配列で登録できるようになりました。
   連想配列のキーが正規表現で、その値がコールバックとなります。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.csprng-functions">
  <h3 class="title"><a href="book.csprng.html" class="link">CSPRNG</a> 関数</h3>

  <p class="para">
   暗号論的に安全な整数値および文字列を生成する、
   プラットフォームに依存しない二つの新しい関数が追加されました。
   <span class="function"><a href="function.random-bytes.html" class="function">random_bytes()</a></span> と <span class="function"><a href="function.random-int.html" class="function">random_int()</a></span> です。
  </p>
 </div>

 <div class="sect2" id="migration70.new-features.list-arrayaccess">
  <h3 class="title">
   <span class="function"><a href="function.list.html" class="function">list()</a></span> が常に、
   <a href="class.arrayaccess.html" class="classname">ArrayAccess</a> を実装したオブジェクトをアンパックできるように
  </h3>

  <p class="para">
   これまでのバージョンでは、<a href="class.arrayaccess.html" class="classname">ArrayAccess</a>
   を実装したオブジェクトに対して <span class="function"><a href="function.list.html" class="function">list()</a></span> が正常に機能しないことがありました。
   PHP 7 ではこの問題が修正されました。
  </p>
 </div>
 
 <div class="sect2" id="migration70.new-features.others">
  <h3 class="title">その他の機能</h3>
  <ul class="itemizedlist">
   <li class="listitem">
    <span class="simpara">
     クローンしたクラスのメンバーにアクセスできるようになりました。
     <em>(clone $foo)-&gt;bar()</em> のようにできるということです。
    </span>
   </li>
  </ul>
 </div>
</div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="migration70.incompatible.html">下位互換性のない変更点</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="migration70.deprecated.html">PHP 7.0.x で推奨されなくなる機能</a></div>
 <div class="up"><a href="migration70.html">PHP 5.6.x から PHP 7.0.x への移行</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
